---
import fs from "node:fs/promises";
import path from "node:path";

function niceName(slug: string) {
  return slug
    .replace(/[-_]+/g, " ")
    .replace(/\s+/g, " ")
    .trim()
    .replace(/\b\w/g, (c) => c.toUpperCase());
}

export async function getStaticPaths() {
  const base = path.join(process.cwd(), "public", "cards");
  let sports: string[] = [];
  try {
    const entries = await fs.readdir(base, { withFileTypes: true });
    sports = entries.filter((e) => e.isDirectory()).map((e) => e.name);
  } catch {
    sports = [];
  }

  return sports.map((sport) => ({ params: { sport } }));
}

const { sport } = Astro.params;
const sportDir = path.join(process.cwd(), "public", "cards", sport);

let sets: string[] = [];
try {
  const entries = await fs.readdir(sportDir, { withFileTypes: true });
  sets = entries.filter((e) => e.isDirectory()).map((e) => e.name);
} catch {
  sets = [];
}

sets.sort((a, b) => a.localeCompare(b, undefined, { numeric: true, sensitivity: "base" }));
const title = niceName(sport);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title} Sets</title>
  </head>

  <body class="min-h-screen bg-zinc-950 text-zinc-100">
    <main class="mx-auto max-w-6xl px-4 py-10">
      <header class="mb-8 flex items-end justify-between gap-4">
        <div>
          <a href="/" class="text-sm text-zinc-400 hover:text-zinc-200">← Back</a>
          <h1 class="mt-3 text-3xl font-semibold tracking-tight">{title}</h1>
          <p class="mt-2 text-zinc-300">Choose a set to view cards.</p>
        </div>
      </header>

      {sets.length === 0 ? (
        <div class="rounded-2xl bg-zinc-950 ring-1 ring-zinc-800 p-6 text-zinc-300">
          No sets found. Add folders under <code class="rounded bg-zinc-900 px-2 py-1 ring-1 ring-zinc-800">public/cards/{sport}/</code>
        </div>
      ) : (
        <section class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {sets.map((set) => (
            <a
              href={`/${sport}/${set}/`}
              class="group rounded-2xl bg-zinc-950 ring-1 ring-zinc-800 hover:ring-zinc-600 transition p-5"
            >
              <div class="text-lg font-semibold">{niceName(set)}</div>
              <div class="mt-1 text-sm text-zinc-300">View cards →</div>
            </a>
          ))}
        </section>
      )}
    </main>
  </body>
</html>

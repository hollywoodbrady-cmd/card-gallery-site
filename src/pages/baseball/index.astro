---
import fs from "node:fs/promises";
import path from "node:path";

function niceName(slug: string) {
  return slug
    .replace(/[-_]+/g, " ")
    .replace(/\s+/g, " ")
    .trim()
    .replace(/\b\w/g, (c) => c.toUpperCase());
}

export async function getStaticPaths() {
  const base = path.join(process.cwd(), "public", "cards");
  const entries = await fs.readdir(base, { withFileTypes: true }).catch(() => []);
  const sports = entries.filter((e) => e.isDirectory()).map((e) => e.name);
  return sports.map((sport) => ({ params: { sport } }));
}

const { sport } = Astro.params;
const sportDir = path.join(process.cwd(), "public", "cards", sport);

const entries = await fs.readdir(sportDir, { withFileTypes: true }).catch(() => []);
let sets = entries.filter((e) => e.isDirectory()).map((e) => e.name);
sets.sort((a, b) => a.localeCompare(b, undefined, { numeric: true, sensitivity: "base" }));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{niceName(sport)} Sets</title>
  </head>
  <body class="min-h-screen bg-zinc-950 text-zinc-100">
    <main class="mx-auto max-w-6xl px-4 py-10">
      <a href="/" class="text-sm text-zinc-400 hover:text-zinc-200">← Back</a>

      <h1 class="mt-3 text-3xl font-semibold tracking-tight">{niceName(sport)}</h1>
      <p class="mt-2 text-zinc-300">Choose a set.</p>

      {sets.length === 0 ? (
        <div class="mt-6 rounded-2xl ring-1 ring-zinc-800 p-6 text-zinc-300">
          No sets found. Add folders under <code class="rounded bg-zinc-900 px-2 py-1 ring-1 ring-zinc-800">public/cards/{sport}/</code>
        </div>
      ) : (
        <section class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {sets.map((set) => (
            <a
              href={`/${sport}/${set}/`}
              class="rounded-2xl bg-zinc-950 ring-1 ring-zinc-800 hover:ring-zinc-600 transition p-5"
            >
              <div class="text-lg font-semibold">{niceName(set)}</div>
              <div class="mt-1 text-sm text-zinc-300">View cards →</div>
            </a>
          ))}
        </section>
      )}
    </main>
  </body>
</html>
